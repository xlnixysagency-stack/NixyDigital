<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NixyDigital – StudyBuddy AI (Beta)</title>

    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Syne:wght@700;800&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        :root{
        --black:#020202;
        --evergreen:#0d2818;
        --forest:#04471c;
        --sea-green:#058c42;
        --malachite:#16db65;
        --white:#FAFAFA;
        }

        body{
        font-family:'Space Grotesk',sans-serif;
        background:var(--black);
        color:var(--white);
        min-height:100vh;
        }

        .topbar{
        display:flex;
        justify-content:space-between;
        align-items:center;
        padding:30px 50px;
        border-bottom:1px solid rgba(22,219,101,.15);
        background:rgba(13,40,24,.6);
        backdrop-filter:blur(10px);
        }

        .logo{
        font-family:'Syne',sans-serif;
        font-size:28px;
        font-weight:800;
        }

        .logo span{color:var(--malachite)}

        .container{
        padding:50px;
        display:grid;
        grid-template-columns:1fr 1fr;
        gap:30px;
        }

        .panel{
        background:var(--evergreen);
        border:1px solid rgba(22,219,101,.2);
        border-radius:14px;
        padding:30px;
        }

        .panel-title{
        font-weight:600;
        margin-bottom:20px;
        color:var(--malachite);
        }

        textarea{
        width:100%;
        min-height:200px;
        background:var(--forest);
        border:1px solid rgba(22,219,101,.3);
        border-radius:8px;
        padding:15px;
        color:var(--white);
        resize:vertical;
        }

        select, input[type="email"]{
        width:100%;
        padding:12px;
        margin-bottom:15px;
        background:var(--forest);
        border:1px solid rgba(22,219,101,.3);
        border-radius:8px;
        color:var(--white);
        }

        .generate-btn{
        padding:14px;
        width:100%;
        background:var(--malachite);
        border:none;
        color:var(--black);
        font-weight:700;
        border-radius:6px;
        cursor:pointer;
        }

        .output{
        margin-top:20px;
        padding:20px;
        background:var(--forest);
        border-radius:8px;
        min-height:120px;
        white-space:pre-wrap;
        line-height:1.6;
        }

        .usage{
        margin-top:10px;
        font-size:13px;
        opacity:.7;
        }

        .waitlist{
        margin-top:20px;
        padding-top:20px;
        border-top:1px solid rgba(22,219,101,.2);
        }

        .footer{
        padding:30px;
        border-top:1px solid rgba(22,219,101,.15);
        text-align:center;
        font-size:13px;
        opacity:.4;
        }
    </style>
</head>

<body>

<script>
    let session = JSON.parse(localStorage.getItem("nixySession"));
    if(!session){window.location.href="auth.html";}

    const PLAN_LIMITS={free:{requests:3}};

    if(!session.plan){session.plan="free";}
    if(typeof session.usage!=="number"){session.usage=0;}
    localStorage.setItem("nixySession",JSON.stringify(session));
</script>

<div class="topbar">
    <div class="logo">NIXY<span>DIGITAL</span></div>
    <div>
        <span id="welcomeUser"></span>
        <span id="usageInfo" style="margin-left:15px;color:#16db65;"></span>
    </div>
</div>

<div class="container">

    <div class="panel">
        <div class="panel-title">Study Material</div>

        <select id="modeSelect">
            <option value="notes">Generate Structured Notes</option>
            <option value="quiz">Generate Quiz (5 Questions)</option>
            <option value="flashcards">Generate Flashcards (10)</option>
        </select>

        <textarea id="studyInput" placeholder="Enter topic or paste study material..."></textarea>

        <button class="generate-btn" onclick="generateContent()">Generate</button>

        <div class="usage" id="limitText"></div>

        <div class="output" id="aiOutput">AI output will appear here.</div>

        <div class="waitlist">
            <div class="panel-title">Pro Version</div>
            <input type="email" id="emailInput" placeholder="Enter email for Pro launch">
            <button class="generate-btn" onclick="joinWaitlist()">Join Waitlist</button>
            <div class="usage" id="waitlistMsg"></div>
        </div>

    </div>

    <div class="panel">
        <div class="panel-title">Uploaded File Preview</div>
        <input type="file" id="fileInput">
        <div class="output" id="fileOutput">No file uploaded.</div>
    </div>

</div>

<div class="footer">
    StudyBuddy AI • Beta v0.1 • Free Tier Active
</div>

<script>

    document.addEventListener("DOMContentLoaded",()=>{

    let session = JSON.parse(localStorage.getItem("nixySession"));
    const PLAN_LIMITS={free:{requests:5}};

    const welcomeUser=document.getElementById("welcomeUser");
    const usageInfo=document.getElementById("usageInfo");
    const limitText=document.getElementById("limitText");

    welcomeUser.textContent="Welcome, "+(session.name||session.email);

    function updateUsage(){
    usageInfo.textContent="FREE • "+session.usage+"/"+PLAN_LIMITS.free.requests;
    limitText.textContent="Free limit: "+(PLAN_LIMITS.free.requests-session.usage)+" generations remaining.";
    }

    updateUsage();

    document.getElementById("fileInput").addEventListener("change",function(){
    const file=this.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=e=>{document.getElementById("fileOutput").textContent=e.target.result.slice(0,2000);};
    reader.readAsText(file);
    });

    window.generateContent=async function(){

    const input=document.getElementById("studyInput").value.trim();
    const mode=document.getElementById("modeSelect").value;
    const output=document.getElementById("aiOutput");

    if(!input){output.textContent="Enter study material.";return;}

    if(session.usage>=PLAN_LIMITS.free.requests){
    output.innerHTML="<strong>Free Limit Reached</strong>\nPro version unlocks unlimited access.";
    return;
    }

    output.textContent="Generating...";

    let prompt;

    if(mode==="notes"){
    prompt="Create structured study notes with headings and bullet points about:\n\n"+input;
    }
    if(mode==="quiz"){
    prompt="Create 5 multiple choice questions with answers about:\n\n"+input;
    }
    if(mode==="flashcards"){
    prompt="Create 10 Q&A flashcards about:\n\n"+input;
    }

    try{
    const response=await fetch("http://localhost:3000/api/chat",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({message:prompt})
    });

    const data=await response.json();

    if(data.error){output.textContent=data.error;return;}

    session.usage++;
    localStorage.setItem("nixySession",JSON.stringify(session));
    updateUsage();

    output.textContent=data.reply;

    }catch{
    output.textContent="AI server not running.";
    }

    };

    window.joinWaitlist=function(){
    const email=document.getElementById("emailInput").value.trim();
    if(!email)return;
    let list=JSON.parse(localStorage.getItem("waitlist"))||[];
    list.push(email);
    localStorage.setItem("waitlist",JSON.stringify(list));
    document.getElementById("waitlistMsg").textContent="Added to waitlist.";
    document.getElementById("emailInput").value="";
    };

    });
</script>

</body>
</html>
